# [학습 목표] ORM의 대표 문제 N+1 정의와 해결 방안

## 1. N+1 문제란?
**N+1 문제**란 1번의 쿼리로 데이터를 조회했는데, 연관된 데이터를 가져오기 위해 **N번의 추가 쿼리**가 실행되어 성능을 저하시키는 현상을 말합니다.


### 발생 원인
1. **지연 로딩(Lazy Loading):** Entity 설정 시 `@ManyToOne(fetch = FetchType.LAZY)`을 사용하면, 최초 조회 시 연관 엔티티는 실제 데이터가 아닌 **프록시(Proxy) 객체**로 채워집니다.
2. **프록시 초기화:** 조회된 엔티티 리스트를 반복문 등으로 순회하며 연관 필드에 접근할 때, JPA는 실제 데이터를 채우기 위해 DB에 추가 쿼리를 보냅니다.
3. **쿼리 폭증:** 만약 부모 엔티티가 10개(N)라면, 각 부모에 속한 자식 엔티티를 가져오기 위해 10번의 추가 쿼리가 발생하여 총 **1 + 10(N)**번의 쿼리가 실행됩니다.

> **참고:** 영속성 컨텍스트의 1차 캐시를 활용하긴 하지만, 조회하려는 각 엔티티의 ID가 모두 다르다면 결국 캐시에 데이터가 없어 매번 DB에 접근하게 됩니다.

---

## 2. N+1 문제가 위험한 이유
* **자원 낭비:** DB 커넥션을 자주 점유하게 되어 서버 전체의 처리량이 떨어집니다.
* **성능 장애:** 데이터가 적을 때는 체감이 안 되지만, 수천 수만 건의 데이터를 처리할 때 서버가 응답 불능 상태에 빠질 수 있습니다.

---

## 3. 대표적인 해결 방법

### 1) Fetch Join

### 2) @EntityGraph

### 3) Batch Size 설정